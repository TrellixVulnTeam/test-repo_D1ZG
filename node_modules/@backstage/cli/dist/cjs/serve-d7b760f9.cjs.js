'use strict';

require('commander');
var chalk = require('chalk');
var index = require('./index-5c3253a4.cjs.js');
var fs = require('fs-extra');
require('@backstage/cli-common');
require('@backstage/config/package.json');
require('webpack');
require('path');
require('fork-ts-checker-webpack-plugin');
require('html-webpack-plugin');
require('react-dev-utils/ModuleScopePlugin');
require('start-server-webpack-plugin');
require('webpack-node-externals');
require('terser-webpack-plugin');
require('./parallel-a4714c72.cjs.js');
require('./config-8c753d87.cjs.js');
require('mini-css-extract-plugin');
require('./svgrTemplate-2d0d15cf.cjs.js');
require('child_process');
require('util');
require('./run-92c96f17.cjs.js');
require('yn');
require('react-dev-utils/FileSizeReporter');
require('react-dev-utils/formatWebpackMessages');
require('webpack-dev-server');
require('react-dev-utils/openBrowser');
var server = require('./server-b64b3f30.cjs.js');
require('@backstage/config-loader');
require('@backstage/config');
var config = require('./config-f0226821.cjs.js');
var uniq = require('lodash/uniq');
require('semver');
require('@yarnpkg/lockfile');
var lint = require('./lint-a14535be.cjs.js');
require('lodash/partition');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var chalk__default = /*#__PURE__*/_interopDefaultLegacy(chalk);
var fs__default = /*#__PURE__*/_interopDefaultLegacy(fs);
var uniq__default = /*#__PURE__*/_interopDefaultLegacy(uniq);

var serve = async (cmd) => {
  const lockfile = await lint.Lockfile.load(index.paths.resolveTargetRoot("yarn.lock"));
  const result = lockfile.analyze({
    filter: lint.includedFilter
  });
  const problemPackages = [...result.newVersions, ...result.newRanges].map(({name: name2}) => name2);
  if (problemPackages.length > 1) {
    console.log(chalk__default['default'].yellow(`\u26A0\uFE0F Some of the following packages may be outdated or have duplicate installations:

          ${uniq__default['default'](problemPackages).join(", ")}
        `));
    console.log(chalk__default['default'].yellow(`\u26A0\uFE0F This can be resolved using the following command:

          yarn backstage-cli versions:check --fix
      `));
  }
  const {name} = await fs__default['default'].readJson(index.paths.resolveTarget("package.json"));
  const waitForExit = await server.serveBundle({
    entry: "src/index",
    checksEnabled: cmd.check,
    ...await config.loadCliConfig({
      args: cmd.config,
      fromPackage: name
    })
  });
  await waitForExit();
};

exports.default = serve;
//# sourceMappingURL=serve-d7b760f9.cjs.js.map
